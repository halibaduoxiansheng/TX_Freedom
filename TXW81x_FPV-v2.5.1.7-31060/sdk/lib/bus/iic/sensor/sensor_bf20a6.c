#include "sys_config.h"
#include "typesdef.h"
#include "lib/video/dvp/cmos_sensor/csi.h"
#include "tx_platform.h"
#include "list.h"
#include "dev.h"
#include "hal/i2c.h"
#if DEV_SENSOR_BF20A6

#if 1
SENSOR_INIT_SECTION static const unsigned char bf20a6InitTable[CMOS_INIT_LEN]=
{

#if 0	//ypc_first_xiaoguo chu tu ok(480*480)
		//X-BNF-V1.1 yangji
		//ypc 20240117
		0xF2 ,0x01 ,
		 
		0x12 ,0x20 ,
		 
		0x3A ,0x00 ,
		 
		0xE1 ,0x92 ,
		 
		0xE3 ,0x02 ,
		 
		0xE0 ,0x00 ,
		 
		0x2A ,0x98 ,
		 
		0x2B ,0x20 ,
		 
		0xCC ,0x02 ,
		 
		0xCD ,0x17 ,
		 
		0xC0 ,0x10 ,
		 
		0xC6 ,0x1D ,
		 
		0x10 ,0x35 ,
		 
		0xE2 ,0x09 ,
		 
		0xE5 ,0x22 ,
		 
		0xE6 ,0x24 ,
		 
		0xE7 ,0x64 ,
		 
		0xE8 ,0xA2 ,
		 
		0x4A ,0x00 ,	
		 
		0x00 ,0x03 ,
		 
		0x1F ,0x02 ,
		 
		0x22 ,0x02 ,
		 
		0x0C ,0x31 ,
		 
		0x00 ,0x00 ,
		 
		0x60 ,0x81 ,
		 
		0x61 ,0x81 ,
		 
		0xA0 ,0x08 ,
		 
		0x01 ,0x1A ,
		 
		0x02 ,0x15 ,
		 
		0x13 ,0x08 ,
		 
		0x8A ,0x96 ,
		 
		0x8B ,0x06 ,
		 
		0x87 ,0x18 ,
		 
		0x34 ,0x48 ,
		 
		0x35 ,0x40 ,
		 
		0x36 ,0x40 ,
		 
		0x71 ,0x44 ,
		 
		0x72 ,0x4A ,
		 
		0x74 ,0xAA ,
		 
		0x75 ,0xA9 ,
		 
		0x78 ,0x23 ,
		 
		0x79 ,0xA0 ,
		 
		0x7A ,0x94 ,
		 
		0x7C ,0x97 ,
		 
		0x40 ,0x30 ,
		 
		0x41 ,0x30 ,
		 
		0x42 ,0x28 ,
		 
		0x43 ,0x1F ,
		 
		0x44 ,0x1C ,
		 
		0x45 ,0x16 ,
		 
		0x46 ,0x13 ,
		 
		0x47 ,0x10 ,
		 
		0x48 ,0x0D ,
		 
		0x49 ,0x0C ,
		 
		0x4B ,0x0A ,
		 
		0x4C ,0x0B ,
		 
		0x4E ,0x09 ,
		 
		0x4F ,0x08 ,
		 
		0x50 ,0x08 ,
		 
		0x5F ,0x29 ,
		 
		0x23 ,0x33 ,
		 
		0xA1 ,0x10 ,
		 
		0xA2 ,0x0D ,
		 
		0xA3 ,0x20 ,
		 
		0xA4 ,0x21 ,
		 
		0xA5 ,0x35 ,
		 
		0xA6 ,0x56 ,
		 
		0xA7 ,0x18 ,
		 
		0xA8 ,0x1A ,
		 
		0xA9 ,0x12 ,
		 
		0xAA ,0x12 ,
		 
		0xAB ,0x16 ,
		 
		0xAC ,0xB1 ,
		 
		0xBA ,0x12 ,
		 
		0xBB ,0x12 ,
		 
		0xAD ,0x12 ,
		 
		0xAE ,0x56 ,
		 
		0xAF ,0x0A ,
		 
		0x3B ,0x30 ,
		 
		0x3C ,0x12 ,
		 
		0x3D ,0x22 ,
		 
		0x3E ,0x3F ,
		 
		0x3F ,0x28 ,
		 
		0xB8 ,0xC3 ,
		 
		0xB9 ,0xA3 ,
		 
		0x39 ,0x47 ,
		 
		0x26 ,0x10 ,
		 
		0x27 ,0x17 ,
		 
		0x28 ,0x14 ,
		 
		0x29 ,0x1A ,
		 
		0xEE ,0x0D ,
		 
		0x13 ,0x05 ,
		 
		0x81 ,0x20 ,
		 
		0x82 ,0x40 ,
		 
		0x83 ,0x30 ,
		 
		0x84 ,0x58 ,
		 
		0x85 ,0x30 ,
		 
		0x92 ,0x08 ,
		 
		0x8A ,0x96 ,
		 
		0x91 ,0xFF ,
		 
		0x94 ,0xF2 ,
		 
		0x9A ,0x18 ,
		 
		0xF0 ,0x46 ,
		 
		0x51 ,0x17 ,
		 
		0x52 ,0x03 ,
		 
		0x53 ,0x5F ,
		 
		0x54 ,0x47 ,
		 
		0x55 ,0x66 ,
		 
		0x56 ,0x0F ,
		 
		0x7E ,0x14 ,
		 
		0x57 ,0x36 ,
		 
		0x58 ,0x2A ,
		 
		0x59 ,0xAA ,
		 
		0x5A ,0xA8 ,
		 
		0x5B ,0x43 ,
		 
		0x5C ,0x10 ,
		 
		0x5D ,0x00 ,
		 
		0x7D ,0x36 ,
		 
		0x5E ,0x10 ,
		 
		0xD6 ,0x80 ,
		 
		0xD5 ,0x20 ,
		 
		0xB0 ,0x84 ,
		 
		0xB5 ,0x08 ,
		 
		0xB1 ,0x80 ,
		 
		0xB2 ,0x80 ,
		 
		0xB3 ,0xD0 ,
		 
		0xB4 ,0xB0 ,
		 
		0x32 ,0x10 ,
		 
		0xA0 ,0x09 ,
		 
		0x00 ,0x03 ,
		 
		0x0B ,0x02 ,
		 
		0x24 ,0x68 ,
		 
		0x72 ,0x4A ,
		 
		0x74 ,0xA2 ,
		 
		0x78 ,0x23 ,
		 
		0x2B ,0x20 ,
		 
		0xCC ,0x02 ,
		 
		0xF0 ,0x43 ,
		 
		0x8A ,0x96 ,
		 
		0x86 ,0x30 ,
		 
		0x78 ,0x01 ,
		 
		0x71 ,0x40 ,
		 
		0xD6 ,0x88 ,
		 
		0x24 ,0x3A ,
		 
		0xA5 ,0x16 ,
		 
		0xB2 ,0xA8 ,
		 
		0x23 ,0x00 ,
		 
		0x74 ,0xA2 ,
		 
		0x24 ,0x60 ,
		 
		0xD6 ,0x8C ,
		 
		0x4A ,0x0C ,	//[3]Horizontal Mirror lmage.[2]Vertical Flip image.
		//0x4a,0x00,
		 
		0x17 ,0x0A ,
		 
		0x18 ,0x82 ,
		 
		0x19 ,0x00 ,
		 
		0x1A ,0x78 ,
		 
		0x70 ,0x0E ,
		 
		0x24 ,0x68 ,
		 
		0x6F ,0x48 ,
		 
		0xA7 ,0x18 ,
		 
		0xA8 ,0x1A ,
		 
		0xA4 ,0x20 ,
		 
		0xA5 ,0x35 ,
		 
		0x28 ,0x16 ,
		 
		0x29 ,0x18 ,
		 
		0xA2 ,0x05 ,
		 
		0xA3 ,0x07 ,
		 
		0x23 ,0x33 ,
		 
		0x94 ,0x12 ,
		 
		0x95 ,0xF1 ,
		 
		0xB1 ,0x72 ,
		 
		0xB2 ,0x80 ,
		 
		0xA0 ,0x08 ,
		 
		0x01 ,0x03 ,
		 
		0x02 ,0x22 ,
		 
		0xB1 ,0x77 ,
		 
		0xB2 ,0xAA ,

#endif

		
#if 0	//OK chu tu(480*480)
			0xf2, 0x01,
			0x12, 0x20,
			0x3a, 0x00,
			0xe0, 0x00,
			0xe1, 0x92,
			0xe3, 0x02,
			0x2a, 0x98,
			0x2b, 0x20,
			0xcc, 0x02,
			0xcd, 0x17,
			0xc0, 0x10,
			0xc6, 0x1d,
			0x10, 0x35,
			0xe2, 0x09,
			0xe4, 0x72,
			0xe5, 0x22,
			0xe6, 0x24,
			0xe7, 0x64,
			0xe8, 0xa2,//DVP:a2},  SPI:f2		 VDDIO=1.8V,E8[2]=1;VDDIO=2.8V,E8[2]=0;
			0x4a, 0x00,
			0x00, 0x03,
			0x1f, 0x02,
			0x22, 0x02,
			0x23, 0x22,
			0x24,0x60 , //48 58 60
			0x0c, 0x31,
			0x00, 0x00,
			0x60, 0x81,
			0x61, 0x81,
			0xa0, 0x08,
			0x01, 0x1a,
			0x02, 0x15,
			0x13, 0x08,
			0x8a, 0x96,
			0x8b, 0x06,
			0x87, 0x18,
			0x34, 0x48,//lens
			0x35, 0x40,
			0x36, 0x40,
			0x71, 0x44,
			0x72, 0x4a,//0x48
			0x74, 0xaa,//0xa2
			0x75, 0xa9,
			0x78, 0x23,//0x12
			0x79, 0xa0,
			0x7a, 0x94,
			0x7c, 0x97,
			0x40, 0x20,
			0x41, 0x30,
			0x42, 0x30,
			0x43, 0x28,
			0x44, 0x22,
			0x45, 0x1a,
			0x46, 0x13,
			0x47, 0x10,
			0x48, 0x0D,
			0x49, 0x0a,
			0x4B, 0x09,
			0x4C, 0x08,
			0x4E, 0x07,
			0x4F, 0x06,
			0x50, 0x04,
			0x5f, 0x29,
			0xa1, 0x10,//AWB
			0xa2, 0x05,
			0xa3, 0x0a,
			0xa4, 0x14,
			0xa5, 0x1d,
			0xa7,0x0a,
			0xa8,0x1d,
			0xa9, 0x12,
			0xaa, 0x12,
			0xab,0x18,
			0xac, 0xb1,
			0xba, 0x12,
			0xbb, 0x12,
			0xad, 0x12,
			0xae, 0x56,
			0xaf, 0x0a,
			0x3b, 0x30,
			0x3c, 0x12,
			0x3d, 0x22,
			0x3e, 0x3f,
			0x3f, 0x28,
			0xb8, 0xc3,
			0xb9, 0xA3,
			0x39, 0x47,//pure color threshold
			0x26, 0x13,
			0x27, 0x16,
			0x28, 0x14,
			0x29, 0x18,
			0xee, 0x0d,
			0x13, 0x05,
			0x81, 0x20,
			0x82, 0x40,
			0x83, 0x30,
			0x84, 0x58,
			0x85, 0x30,
			0x92, 0x08,
			0x86, 0xA0,
			0x8a, 0x5b,//0x96
			0x91, 0xff,
			0x94, 0x62,
			0x9a, 0x18,//outdoor threshold
			0xf0, 0x46,//0x4e
			0x51, 0x1c,//color normal
			0x52, 0x07,
			0x53, 0x73,
			0x54, 0x5E,
			0x55, 0x81,
			0x56, 0x17,
			0x7e, 0x16,
			0x57, 0x36,//AÃ¥ÂÂcolor
			0x58, 0x2A,
			0x59, 0xAA,
			0x5a, 0xA8,
			0x5b, 0x43,
			0x5c, 0x10,
			0x5d, 0x00,
			0x7d, 0x36,
			0x5e, 0x10,
			0xd6, 0xb8,//contrast,0x88
			0xd5, 0x20,//Ã¤Â½ÂÃ¥ÂÂÃ¥ÂÂ Ã¤ÂºÂ®Ã¥Âº?
			0xb0, 0x84,//Ã§ÂÂ°Ã¨ÂÂ²Ã¥ÂÂºÃ¥ÂÂÃ©ÂÂÃ©Â¥Â±Ã¥ÂÂÃ¥ÂºÂ¦
			0xb5, 0x08,//Ã¤Â½ÂÃ¥ÂÂÃ©ÂÂÃ©Â¥Â±Ã¥ÂÂÃ¥ÂºÂ¦Ã©ÂÂÃ¥??
			0xb1, 0xa0,//saturation
			0xb2,0xa8,
			0xb3, 0xd0,
			0xb4, 0xB0,
			//{0xb6, 0x1},//colorbar
			0x32, 0x10,
			0xa0, 0x08,
			0x00, 0x03,
			0x01,0x07,
			0x02,0x1d,
			0x0b, 0x02,
			0x72, 0x4a,
			0x74, 0xa2,
			0x78, 0x23,
			0x2b, 0x20,
			0xcc, 0x02,
			0xf0,0x47,
			0x86, 0x30,
			0x8a, 0x7d,
			0x78,0x25,
			0x71, 0x40,
			0xd6,0x90,
			0x17, 0x15, // 480x480
			0x18, 0x8d,
			//2023.12.1
			0x24,0x44,
			0xb1,0x90,
			0xb2,0x98,
			0xd6,0x90,
			0x01,0x08,
			0x02,0x21,
			0x78,0x22,
			//2023.12.,
			0x86,0xA0,
			0x8a,0xbd,
			0x72,0x2f,
			//2023.12.,
			0xa0,0x09,
			0xa2,0x05,
			0xa3,0x10,
			0xa4,0x24,
			0xa5,0x34,
			0x23,0x11,
			0x5f,0x29,
			0xa7,0x12,
			0xa8,0x1a,
			0x24,0x4C,
			0xb1,0x90,
			0xb2,0x98,
			0x78,0x22,
		
		//20240103
			0x24,0x38,
			0x78,0x22,
			0x86,0x60,
			0xA4,0x1b,

#endif


#if 1	//ypc_20240822 20A6	(640*480)
		0xF2,0x01,
		0x12,0x20,
		0x3A,0x00,
		0xE1,0x92,
		0xE3,0x02,
		0xE0,0x00,
		0x2A,0x98,
		0x2B,0x20,
		0xCC,0x02,
		0xCD,0x17,
		0xC0,0x10,
		0xC6,0x1D,
		0x10,0x35,
		0xE2,0x09,
		0xE4,0x72,
		0xE5,0x22,
		0xE6,0x24,
		0xE7,0x64,
		0xE8,0xA2,
		0x4A,0x00,
		0x00,0x03,
		0x1F,0x02,
		0x22,0x02,
		0x0C,0x31,
		0x00,0x00,
		0x60,0x81,
		0x61,0x81,
		0xA0,0x08,
		0x01,0x1A,
		0x02,0x15,
		0x13,0x08,
		0x8A,0x96,
		0x8B,0x06,
		0x87,0x18,
		0x34,0x48,
		0x35,0x40,
		0x36,0x40,
		0x71,0x44,
		0x72,0x4A,
		0x74,0xAA,
		0x75,0xA9,
		0x78,0x23,
		0x79,0xA0,
		0x7A,0x94,
		0x7C,0x97,
		0x40,0x30,
		0x41,0x30,
		0x42,0x28,
		0x43,0x1F,
		0x44,0x1C,
		0x45,0x16,
		0x46,0x13,
		0x47,0x10,
		0x48,0x0D,
		0x49,0x0C,
		0x4B,0x0A,
		0x4C,0x0B,
		0x4E,0x09,
		0x4F,0x08,
		0x50,0x08,
		0x5F,0x29,
		0x23,0x33,
		0xA1,0x10,
		0xA2,0x0f,
		0xA3,0x35,
		0xA4,0x05,
		0xA5,0x20,
		0xA6,0x56,
		0xA7,0x18,
		0xA8,0x1A,
		0xA9,0x12,
		0xAA,0x12,
		0xAB,0x16,
		0xAC,0xB1,
		0xBA,0x12,
		0xBB,0x12,
		0xAD,0x12,
		0xAE,0x56,
		0xAF,0x0A,
		0x3B,0x30,
		0x3C,0x12,
		0x3D,0x22,
		0x3E,0x3F,
		0x3F,0x28,
		0xB8,0xC3,
		0xB9,0xA3,
		0x39,0x47,
		0x26,0x15,
		0x27,0x19,
		0x28,0x12,
		0x29,0x16,
		0xEE,0x0D,
		0x13,0x05,
		0x81,0x20,
		0x82,0x40,
		0x83,0x30,
		0x84,0x58,
		0x85,0x30,
		0x92,0x08,

		0x8A,0x96,
		0x91,0xFF,
		0x94,0xf2,
		0x9A,0x18,
		0xF0,0x46,
		0x51,0x17,
		0x52,0x03,
		0x53,0x5F,
		0x54,0x47,
		0x55,0x66,
		0x56,0x0F,
		0x7E,0x14,
		0x57,0x36,
		0x58,0x2A,
		0x59,0xAA,
		0x5A,0xA8,
		0x5B,0x43,
		0x5C,0x10,
		0x5D,0x00,
		0x7D,0x36,
		0x5E,0x10,
		0xD6,0x80,
		0xD5,0x20,
		0xB0,0x84,
		0xB5,0x08,
		0xB1,0x80,	
		0xB2,0x80,	
		0xB3,0xD0,
		0xB4,0xB0,
		0x32,0x10,
		0xA0,0x09,
		0x00,0x03,
		0x0B,0x02,
		
		0x24,0x68,
		0x72,0x4A,
		0x74,0xA2,
		0x78,0x23,
		0x2B,0x20,
		0xCC,0x02,
		0xF0,0x43,
		0x8A,0x96,
		0x86,0x30,
		0x78,0x01,
		0x71,0x40,
		0xD6,0x88,
		0x24,0x3A,
		0xA5,0x16,
		0xB2,0xA8,
		0x23,0x00,
		0x74,0xA2,
		0x24,0x60,
		0xD6,0x8C,
		0x4a,0x0c,		//b6\k2
		//0x4a,0x00,	
		0x70,0x0e,

		#if 1	
		//480*480
		0x17,0x1e,//0x00, //20240914
		0x18,0x96,//0xa0, //20240914
		#else
		//640*480
		0x17,0x00, 
		0x18,0xa0, 
		#endif
		
		0x19,0x00,
		0x1A,0x78, 


		
		0x24,0x6b,
		0x6f,0x48,
		0xa7,0x18,
		0xa8,0x1a,
		0xa4,0x19,
		0xa5,0x1c,
		0x28,0x16,
		0x29,0x18,
		
		0xa2,0x08,
		0xa3,0x0a,
		0x23,0x33,
		0x94,0x12,
		0x95,0xf1,
		0xb1,0x72,
		0xb2,0x80,
		0xb2,0x6f,
				
		//20231206
		0xa0,0x08,
		
		0x01,0x05,
		0x02,0x26, 
		0xb1,0x77,
		0xb2,0xaa,
#if 0	//no used
		//Ò»ÌåÐ§¹û--------------------
		0x34,0x48,
		0x35,0x30,
		0x36,0x40,
		
		0xa0,0x08,
		0x01,0x06,
		0x02,0x28,
		0xa2,0x04,
		0xa3,0x06,
		0xa4,0x26,
		0xa5,0x30,
		0xa0,0x09,
		
		0x5f,0x21,
		0xa1,0x30,
		0x24,0x5c,
		0x94,0x02,
		0xb1,0xb0,
		0xb2,0x90,
		0x80,0x88,
#endif


#endif

		-1,-1
};

#endif



extern struct i2c_device *iic_test;


static void bf20a6_rotate(uint32 r)
{
	unsigned char buf[2];
	buf[0] = 0x1e;
	//buf[1] = Sensor_ReadRegister(buf,u8AddrLength,u8DataLength);
	//buf[1] &=~(3<<4);
	buf[1] = (r<<4)|0x00;
	//i2c_sensor_write(iic_test,buf,1,1,0x42,0x43);
	i2c_write(iic_test,(int8 *)buf,1,(int8 *)&buf[1],1);

}



uint32 bf20a6_hvblank(int8 dh,int8 dv)
{
#define HBLANK_BASE	0x00UL
#define VBLANK_BASE	0x00UL
		uint32 i;
		int32 h = (int32)HBLANK_BASE + dh; if(h < 0) h = 0;
		int32 v = (int32)VBLANK_BASE + dv; if(v < 0) v = 0;
		const uint8 t[][2] = {
			{0x2a,(h >> 8) << 4 },
			{0x2b,h & 0xff},
			{0x92,v & 0xff},
			{0x93,v >> 8},
			{0xe3,0x00},
			{0xe4,0},
		};


	for(i=0;i<6;i++)
		i2c_write(iic_test,(int8 *)&t[i][0],1,(int8 *)&t[i][1],1);
		//i2c_sensor_write(iic_test,(uint8 *)&t[i][0],1,1,0x42,0x43);


	return (h<<16)|v;
}

/*
1Â¡Â¢2Â£Âº	480*480
3Â£Âº		640*480
*/

SENSOR_OP_SECTION const _Sensor_Adpt_ bf20a6_cmd= 
{
	.typ = 1, //YUV
	.pixelw = 480,//640,//
	.pixelh= 480,
	.hsyn = 1,
	.vsyn = 1,
	.rduline = 0,//
	.rawwide = 1,//10bit
	.colrarray = 2,//0:_RGRG_ 1:_GRGR_,2:_BGBG_,3:_GBGB_
	.init = (uint8 *)bf20a6InitTable,
	.rotate_adapt = {0},
	//.hvb_adapt = {0xde,0x24,0xde,0x24},
	. mclk = 24000000,
	//.p_fun_adapt = {bf20a6_rotate,bf20a6_hvblank,NULL},
	.p_xc7016_adapt = {NULL},

};

//0xfc>>0x20,0xfd>>0xa6
const _Sensor_Ident_ bf20a6_init=
{
	0x20,0xdc,0xdd,0x01,0x01,0xfc,//bf3
};

#endif
